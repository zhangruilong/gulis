<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="utf-8">
<title>谷粒网</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Charisma, a fully featured, responsive, HTML5, Bootstrap admin template.">
<link rel="stylesheet" href="css/layout.css">
<link rel="stylesheet" href="css/color.css">
<link rel="stylesheet" href="css/normalize.css">
<link rel="stylesheet" href="css/main.css">
<link rel="stylesheet" href="css/wzhWeb.css">
<script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>

<link rel="stylesheet" type="text/css" href="css/top1.css">
<link rel="stylesheet" type="text/css" href="css/news.css">
<link rel="stylesheet" type="text/css" href="css/details.css">
<link rel="stylesheet" type="text/css" href="css/basic.css">
<link rel="stylesheet" type="text/css" href="css/Evaluation.css">
<link rel="stylesheet" href="css/share_style0_16.css">
<link rel="stylesheet" href="css/share_popup.css">
<link rel="stylesheet" href="css/global.css">
</head>
<body>
	<div class="ContainerBox"
		style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">
		<div class="headTopBox">
			<div class="contentBody">
				<div class="topline">
					<div class="top">
						<div class="toplineleft">
							<span class="wzh-won">谷粒网</span>
							<!-- <ul>
								<li><a href="javascript:void(0)"
									id="index_login_button" class="top-userlogin">请您登录</a></li>

								<li><a
									href="javascript:void(0)">注册有礼</a></li>
							</ul> -->
						</div>
						<div class="menu">
							<ul class="tlrtext">
									<li><span class="topwelcome"><Q>您好， 欢迎来到谷粒网！</Q></span></li>
									<li><a
										href="javascript:void(0)">用户中心<i
											class="triangleIco"></i></a>
										<ul class="topMenu-text">
											<li><a href="usershop.html">我的店铺</a></li>
											<li><a href="userorder.html">我的订单</a></li>
											<li><a href="usercollect.html">我的收藏</a></li>
											<li><a href="javascript:void(0)">我的谷币</a></li>
											<li><a href="useraddress.html">收货地址</a></li>
											<li><a href="bindingcom.html">我的供货商</a></li>
											<li><a href="userpwd.html">修改密码</a></li>
										</ul></li>
									<li style="display: none;"><a id="shopping_card_button"
										href="#"><i
											class="triangleIco"></i> 购物车 <Q id="shoppingCart">0</Q> 件</a>
										<ul>
											<div class="top-cart" id="headerShoppingCart"></div>
										</ul></li>
									<li><a id="more_button"
										href="#">更多</a>
										<ul class="topMenu-text">
											<li><a title="谷粒网" id="topbar_collect_net"
												href="javascript:void(0)" rel="sidebar">收藏本站</a></li>
											<li><a id="topbar_question"
												href="#"
												target="_blank">常见问题</a></li>
										</ul></li>
								</ul>
						</div>
					</div>
				</div>
				<!--topline-->
				<!--头部、LOGO、搜索栏-->
				<div class="headCont">
					<!--LOGO-->
					<div class="TopLogo">
						<img src="images/logo.png" title="谷粒">
					</div>
					<!--搜索栏-->
					<div class="search">
								<input name="w" class="search-text" id="w" type="text" onkeydown="seachkeydow()"
									placeholder="请输入要搜索的词" value="" autocomplete="off"
									x-webkit-speech="x-webkit-speech">

								<div class="search-button">
									<button class="btn-search" type="button" onclick="doseach()"
											value="搜索">搜索</button>
								</div>
							</div>
					<!--保证-->
						<div class="ensure">
							<!-- <a class="wzhImg refund" href="#"></a> -->
							<a class="wzhImg guo" href="cart.html"><span id="totalnum" style="display: none;"></span></a>
							<!-- <a class="wzhImg ka" href="#"></a> -->
						</div>

					<!--主导航菜单-->
					<div class="whz-mainNav wzh-container">
						<div class="whz-mainNav-hd">
							<span class="wzh-mainNav-tit">全部商品分类
								<div class="whz-mainNav-hd-cont">
									<ul>
										<li><a onclick="dogoodsxdpage('G14630381061319233','');" href="gflshow.html">品牌专区</a>
											<div class="wzh-mainNav-three">
												<H4>品牌专区</H4>
												<ul name="dhl-ppzq">
													
												</ul>
											</div></li>
										<li><a onclick="dogoodsxdpage('G14630381061319232','');" href="gflshow.html">裸价专区</a>
											<div class="wzh-mainNav-three">
												<H4>裸价专区</H4>
												<ul name="dhl-ljzq"><li><a onclick="dogoodsxdpage('G14630381061319232','');" href="gflshow.html">裸价商品</a></li></ul>
											</div></li>
										<li><a onclick="dogoodsxdpage('43','');" href="gflshow.html">粮油米面</a>
											<div class="wzh-mainNav-three">
												<H4>粮油米面</H4>
												<ul name="dhl-lymm"></ul>
											</div></li>
										<li><a onclick="dogoodsxdpage('42','');" href="gflshow.html">调味酱汁</a>
											<div class="wzh-mainNav-three">
												<H4>调味酱汁</H4>
												<ul name="dhl-twjz">
												</ul>
											</div></li>
										<li><a onclick="dogoodsxdpage('41','');" href="gflshow.html">南北干货</a>
											<div class="wzh-mainNav-three">
												<H4>南北干货</H4>
												<ul name="dhl-nbgh">
												</ul>
											</div></li>
										<li><a onclick="dogoodsxdpage('38','');" href="gflshow.html">休闲食品</a>
											<div class="wzh-mainNav-three">
												<H4>休闲食品</H4>
												<ul name="dhl-xxsp">
													<li><a onclick="dogoodsxdpage('38','');" href="gflshow.html">方便食品</a></li>
												</ul>
											</div></li>
									</ul>
								</div>
							</span>
						</div>
<script type="text/javascript">
$(function(){
	cartNum();													//初始化购物车上的商品数量
	$.ajax({
		url:"AbfGoodsclassAction.do?method=selPCHomeGC",
		type:"post",
		data:{
			cusid:customer.customerid
		},
		success:function(resp){
			var data = eval('('+resp+')');
			$.each(data.root[1],function(i,item){
				$('.wzh-mainNav-three ul[name="dhl-ppzq"]').append('<li><a onclick="dogoodsxdpage(\'G14630381061319233\',\''+item.goodsclassname+
						'\');" href="gflshow.html">'+item.goodsclassname+'</a></li>');
			});
			$.each(data.root[0],function(i,item){
				if(item.goodsclassparent == '42'){
					$('.wzh-mainNav-three ul[name="dhl-twjz"]').append('<li><a onclick="dogoodsxdpage(\'42\',\''+item.goodsclassname+
							'\');" href="gflshow.html">'+item.goodsclassname+'</a></li>');
				} else if(item.goodsclassparent == '43'){
					$('.wzh-mainNav-three ul[name="dhl-lymm"]').append('<li><a onclick="dogoodsxdpage(\'43\',\''+item.goodsclassname+
							'\');" href="gflshow.html">'+item.goodsclassname+'</a></li>');
				} else if(item.goodsclassparent == '41'){
					$('.wzh-mainNav-three ul[name="dhl-nbgh"]').append('<li><a onclick="dogoodsxdpage(\'41\',\''+item.goodsclassname+
							'\');" href="gflshow.html">'+item.goodsclassname+'</a></li>');
				}
			});
		},
		error:function(resp){
			var data = eval("("+resp+")");
			alert(data.msg);
			//window.location.href = "login.html";
		}
	});
});
</script>
						<ul class="whz-mainNav-menu">
							<li><a href="homepage.html">首页</a></li>
							<li><a href="msgshow.html">秒杀专区</a></li>
							<li><a href="mzgshow.html">买赠专区</a></li>
							<li><a onclick="dogoodsxdpage('G14630381061319233','');" href="gflshow.html">品牌专区</a></li>
							<li><a onclick="dogoodsxdpage('G14630381061319232','');" href="gflshow.html">裸价专区</a></li>
						</ul>
					</div>
				</div>
			</div>
			<!-- headTopBox -->
		</div>
		<!--contentBody-->
		<!-- headTop -->

		<!-- navBox -->
		<div class="UpTop" style="top: 554px;">
			<ul>
				<!-- <li class="Up-help">
             	<i class="wzhImg r-help"></i>
                <a class="upTop-text" href="#">帮助中心</a>
             </li> -->
				<li class="Up-feedback"><i class="wzhImg r-opinion"></i> <a
					class="upTop-text" href="">意见反馈</a></li>
				<li class="goTopBtn" style="display: block; left: 1283px;"><i
					class="wzhImg UpTop-fx"></i> <a class="upTop-text" href="">返回顶部</a></li>
			</ul>
		</div>
		<!--UpTop-->
		<script type="text/javascript" src="js/base.js"></script>
		<script type="text/javascript">
			$(function() {
				//part1
				$(".wzh-mainNav-tit").hover(
						function() {
							$(this).children(".whz-mainNav-hd-cont", "this")
									.fadeToggle(0);
						})
				$(window).scroll(function() {
					var sc = $(window).scrollTop();
					var rwidth = $(window).width()
					if (sc > 0) {
						$("#goTopBtn").css("display", "block");
						$("#goTopBtn").css("left", (rwidth - 36) + "px");
					} else {
						$("#goTopBtn").css("display", "none");
					}
				});
				$("#goTopBtn").click(function() {
					var sc = $(window).scrollTop();
					$('body,html').animate({
						scrollTop : 0
					}, 100);
				});
			});
		</script>
		<script type="text/javascript">
			var pathname = window.location.pathname;//获取url路径
			jQuery(".whz-mainNav-menu").children("li").each(
					function() {
						jQuery(this).children("a").each(
								function() {
									var selectUrl = jQuery(this).attr("href");
									if (selectUrl.indexOf("?") > 0) {
										selectUrl = selectUrl.substring(0,
												selectUrl.indexOf("?"));
									}
									if (pathname == selectUrl) {
										jQuery(this).addClass("selectedHover");
									}
								});
					});

			$("#topbar_collect_net")
					.click(
							function() {
								if (!!window.ActiveXObject
										|| "ActiveXObject" in window) {
									window.external.addFavorite(document.URL,
											document.title);
								} else if (isFirefox = navigator.userAgent
										.indexOf("Firefox") > 0) {
									window.sidebar.addPanel(document.title,
											document.URL, "");
								} else {
									alert("您的浏览器暂不支持此操作，请使用Ctrl+D进行添加,或手动在浏览器里进行设置.");
								}
							});
		</script>
		<!--主体开始-->
		<div class="contentBody"
			style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">

			<div class="location" name="cb-nowposi">
				<!-- <a href="homepage.html">首页</a> » 
				<a href="javascript:void(0)" categoryid="1002" id="g-parent">美食</a> » 
				<a href="javascript:void(0)" categoryid="10021057" id="g-children">蛋糕</a> -->
			</div>
			<!--sp-Title-->
			<div class="clearD"></div>
			<div class="leftSubject leftBox-f"
				style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">

				<div class="deal-box"
					style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">
					<div style="display: none" id="userIds"></div>
					<header class="deal-title">
						<!-- 这里是买赠信息 -->
						<h3 class="deal-sj-tit-mzInfo"></h3>
					</header>
					<div class="deal-introduce-img">
						<img class="scrollLoading" id="converPicture" width="327"
							height="327" onerror="" src="">
					</div>
					<!--deal-introduce-img-->
					<div class="deal-introduce-info"
						style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;">

						<ul>
							<li
								style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">
								<div class="deal-sp-price"
									style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">
									<span class="deal-sj-tit"></span>
									<div class="original-price"
										style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">
										<!-- 	                            		现价： -->
										<strong id="yufu"
											style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">¥29.00</strong>
									<!-- 这里是原价 -->
										<del style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">￥998</del>
									</div>
									<!-- <div class="now-pay" style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">
										买一箱，送5kg恒大珍珠米一号4袋，送900ml恒大葵花籽油4瓶！
									</div> -->
								</div>
							</li>
							<li>
								<div class="buy_statistics">
									已售 <strong><q id="alreadySold"></q></strong> <span>剩余 <strong></strong></span>
								</div>
							</li>
							<li><label>物流</label> <span class="goods-date"></span></li>
							<li class="order-number"><label>数量</label>
								<button type="button" class="item-minus" value="-" max="300">-</button>
								<input type="text" class="order-num-s" name="orderNumber" readonly="readonly"
								value="1" max="300">
								<button type="button" class="item-plus" value="+" max="300">+</button>
								
								<span class="order-number-msg" style="display: none">仅可购买<strong>300</strong>件商品
							</span></li>
							<li><span class="buy-area"> <input type="button"
									class="button" id="to_NOWshopping" value="立即购买" alt="snapBut">
									<input type="button"
									class="button" id="to_shopping" value="加入购物车" alt="snapBut">
									<span hidden="true" id="span-gdata"></span>
									<input type="checkbox" id="currentgipc" name="" class="chk_1" >
 	            		<label for="currentgipc" onclick="checkedgoods();"><span>收藏</span></label>
							</span> 
							 <span class="media-fx">
									<div class="bdsharebuttonbox bdshare-button-style0-16"
										data-bd-bind="1467079239641">
										<a
											href="javascript:void(0)"
											class="bds_more" data-cmd="more"></a> <a
											href="javascript:void(0)"
											class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a> <a
											href="javascript:void(0)"
											class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a> <a
											href="javascript:void(0)"
											class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a> <a
											href="javascript:void(0)"
											class="bds_renren" data-cmd="renren" title="分享到人人网"></a> <a
											href="javascript:void(0)"
											class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
									</div>
							</span></li>
						</ul>
					</div>
				</div>
			</div>

			<div class="clearD"></div>
		</div>



		<div class="clearD"></div>
		<!--clearD-->
	</div>
	<!--页脚开始-->
	<div id="footBot">
		<div class="footBox">
			<div class="wzh-footer">
				<ul>
					<li><a href="javascript:void(0)">关于我们</a></li>
					<li><a href="javascript:void(0)">加入我们</a></li>
					<li><a href="javascript:void(0)">入门教程</a></li>
					<li><a href="javascript:void(0)">谷粒承诺</a></li>
					<li><a
						href="javascript:void(0)">反诈骗公告</a></li>
					<li><a
						href="javascript:void(0)">隐私声明</a></li>
				</ul>
				<p style="color: #fff;">©2016 版权所有 上海域链信息科技有限公司</p>
			</div>
		</div>
		<!--headTopBox-->
	</div>

<script type="text/javascript">
var goodsid = getQueryString("goodsid");
var customer = JSON.parse(window.localStorage.getItem("customer"));
var goodsclassparent = window.localStorage.getItem("goodsclassparent");
var goodsclassname = window.localStorage.getItem("goodsclassname");
$(function() {
		$.ajax({
			url:"AbfGoodsviewAction.do?method=goodsxd",
			type:"post",
			data:{
				customerid:customer.customerid,
				goodsid:goodsid,
				goodsclassparent:goodsclassparent
			},
			success:function(resp){
				var goodsJSON = JSON.parse(resp).root[0];
				if(goodsclassparent == 'G14630381061319233'){
					goodsclassparent='品牌专区';
				}
				//window.localStorage.setItem('goodsparentname',goodsJSON.goodsclassdetail);
				$('.contentBody div[name="cb-nowposi"]').html('<a href="homepage.html">首页</a> » '+
						'<a href="gflshow.html" categoryid="1002" id="g-parent">'+goodsJSON.goodsclassdetail+'</a> » '+
						'<a href="gflshow.html" categoryid="10021057" id="g-children">'+goodsclassname+'</a>');
				$("#span-gdata").text(JSON.stringify(goodsJSON));
				$(".deal-sj-tit").html(goodsJSON.goodsname + '<span class="prs_Unit">('+ goodsJSON.goodsunits + ')</span>');
				$("#yufu").text("￥" + goodsJSON.pricesprice + "/" + goodsJSON.pricesunit);
				$("#yufu").next().remove();
				var goods_date = goodsJSON.companydetail;
				if(goodsJSON.goodstype){
					goods_date += "."+goodsJSON.goodstype;
				}
				$(".goods-date").text(goods_date);
				$(".buy_statistics").html('<label>经销商</label> <span class="goods-date" style="color:black">'+goodsJSON.companyshop+'</span>');
				$(".scrollLoading").attr("src", goodsJSON.goodsimage);
				$(".order-num-s").val(getcurrennum(goodsJSON.goodsid,goodsJSON.goodsclassname));
				$("#currentgipc").attr('name',goodsJSON.goodsid);
				$("#currentgipc").attr('checked',goodsJSON.goodsdetail);
				$(".item-plus").click(function() {
					var num = parseInt($(".order-num-s").val());
					$(".order-num-s").val(num + 1);
				});
				$(".item-minus").click(function() {
					var num = parseInt($(".order-num-s").val());
					if (num > 0) {
						$(".order-num-s").val(num - 1);
					}
				});
				$("#to_shopping").click(function (){
					doCart();
				});
				$("#to_NOWshopping").click(function(){
					if(doCart()){
						window.location.href = 'cart.html';
					}
				});
			},
			error : function(resp){
				var respText = eval('('+resp+')');
				alert(respText.msg);
			}
		});
});
//收藏商品
function checkedgoods(){
	var goodsid = $("#currentgipc").attr('name');
	if(typeof(customer.customerid) == 'undefined' || !customer.customerid){
		alert("必须先登录才能进行此操作。");
		window.location.href = 'login.html';
		return;
	}
	var url = 'AbfCollectAction.do?method=';
	if($("#currentgipc").is(':checked')){
		url +='delAllByGoodsid';
	}else{
		url +='insAllByGoodsid';
	}
	var json = '[{"collectgoods":"' + goodsid + 
		'","collectcustomer":"' + customer.customerid + '"}]';
	$.ajax({
		url : url,
		data : {
			json : json
		},
		success : function(resp) {
			var data = eval('('+resp+')'); 
			if(data.msg=='操作失败'){
				location.reload();
			} else if(data.msg=='操作成功'){
				alert("收藏成功,您可以在我的收藏中查看收藏的商品。");
			}
		},
		error : function(resp) {
			var data = eval('('+resp+')');
			alert(data.msg);
		}
	});
}
//得到商品数量
function getcurrennum(dishesid,goodsclassname){
	//订单
	if(window.localStorage.getItem("sdishes")==null){
		return 0;
	}else{
		var orderdetnum = 0;
		var sdishes = JSON.parse(window.localStorage.getItem("sdishes"));
		$.each(sdishes, function(i, item) {
			if(item.goodsid==dishesid
					&&item.goodsclassname==goodsclassname){
				orderdetnum = item.orderdetnum;
				return false;
			}
		});
		return orderdetnum;
	}
}
//加入购物车
function doCart() {
	var goodsJSON = JSON.parse($("#span-gdata").text());
	var price = 0.0;
	var goodsid = '';
	var goodsclassname = '';
		price = goodsJSON.pricesprice;
		goodsid = goodsJSON.goodsid;
		goodsclassname = goodsJSON.goodsclassname;
	var num = parseInt($(".order-num-s").val());
	if(num == 0){
		alert('请选择购买的数量。');
		return;
	}
	var flag = false;
	if (window.localStorage.getItem("sdishes") == null || window.localStorage.getItem("sdishes") == "[]") { //判断有没有购物车
		window.localStorage.setItem("sdishes", "[]"); 														//创建一个购物车
			flag = addMdishes(goodsJSON);						//加入购物车
		if(flag == false){
			return;
		}
		window.localStorage.setItem("totalnum", 1); 														//设置缓存中的种类数量等于一 
		window.localStorage.setItem("totalmoney",(parseFloat(price) * num).toFixed(2)); 	//总金额等于商品价
		var cartnum = parseInt(window.localStorage.getItem("cartnum")); 									//商品总数
		window.localStorage.setItem("cartnum", $(".order-num-s").val());
	} else {
		var sdishes = JSON.parse(window.localStorage.getItem("sdishes")); 									//将缓存中的sdishes(字符串)转换为json对象
		var tnum = parseInt(window.localStorage.getItem("totalnum")); 										//取出商品的总类数
		$.each(sdishes,function(i, item) { 																	//遍历购物车中的商品
							if (item.goodsid == goodsid && item.goodsclassname == goodsclassname) {			//如果有这个商品
								var tmoney = parseFloat(window.localStorage.getItem("totalmoney")); 		//从缓存中取出总金额 
								var oldmoney = parseFloat(item.pricesprice) * item.orderdetnum;	//得到旧的金额
								var newtmoney = parseFloat(price)* num;							//得到新的金额
								window.localStorage.setItem("totalmoney", parseFloat(tmoney - oldmoney +newtmoney).toFixed(2));
								var cartnum = parseInt(window.localStorage.getItem("cartnum"));
								window.localStorage.setItem("cartnum",(cartnum - item.orderdetnum) + num);
								item.orderdetnum = num;														//把商品数量修改为新的数量
								window.localStorage.setItem("sdishes",JSON.stringify(sdishes));
								flag = true;
								return false;
							} else if (i == (tnum - 1)) {
									flag = addMdishes(goodsJSON);						//加入购物车
								if(flag == false){
									return;
								}
								window.localStorage.setItem("totalnum",tnum + 1); 							//商品种类数加一
								var tmoney = parseFloat(window.localStorage.getItem("totalmoney")); 		//从缓存中取出总金额
								var newtmoney = (tmoney + parseFloat(price)* num).toFixed(2);
								window.localStorage.setItem("totalmoney", newtmoney);
								var cartnum = parseInt(window.localStorage.getItem("cartnum"));
								window.localStorage.setItem("cartnum",cartnum + num);
							}
						})
	}
	if(flag){
		cartNum();													//初始化购物车上的商品数量
		alert("成功加入购物车!");
	} else {
		alert("加入购物车失败。");
	}
	return flag;
}
//新增商品订单
function addMdishes(goodsJSON) {
	var sdishes = JSON.parse(window.localStorage.getItem("sdishes")); 					//将缓存中的sdishes(字符串)转换为json对象
	var mdishes = new Object();
	mdishes.goodsid = goodsJSON.goodsid;
	mdishes.goodsdetail = goodsJSON.goodsdetail;
	mdishes.goodscompany = goodsJSON.goodscompany;
	mdishes.companyshop = goodsJSON.companyshop;
	mdishes.companydetail = goodsJSON.companydetail;
	mdishes.goodsclassname = goodsJSON.goodsclassname;
	mdishes.goodscode = goodsJSON.goodscode;
	mdishes.pricesprice = goodsJSON.pricesprice;
	mdishes.pricesunit = goodsJSON.pricesunit;
	mdishes.goodsname = goodsJSON.goodsname;
	mdishes.goodsimage = goodsJSON.goodsimage;
	mdishes.orderdtype = '商品';
	mdishes.goodsunits = goodsJSON.goodsunits;
	mdishes.orderdetnum = $(".order-num-s").val();
	sdishes.push(mdishes); 																//往json对象中添加一个新的元素(订单)
	window.localStorage.setItem("sdishes", JSON.stringify(sdishes));
	return true;
}
</script>
</body>
</html>