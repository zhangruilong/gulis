<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="utf-8">
<title>谷粒网</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Charisma, a fully featured, responsive, HTML5, Bootstrap admin template.">
<link rel="stylesheet" href="css/global.css">
<link rel="stylesheet" href="css/layout.css">
<link rel="stylesheet" href="css/color.css">
<link rel="stylesheet" href="css/normalize.css">
<link rel="stylesheet" href="css/main.css">
<link rel="stylesheet" href="css/wzhWeb.css">
<script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>

<link rel="stylesheet" type="text/css" href="css/top1.css">
<link rel="stylesheet" type="text/css" href="css/news.css">
<link rel="stylesheet" type="text/css" href="css/details.css">
<link rel="stylesheet" type="text/css" href="css/basic.css">
<link rel="stylesheet" type="text/css" href="css/Evaluation.css">
<link rel="stylesheet" href="css/share_style0_16.css">
<link rel="stylesheet" href="css/share_popup.css">
</head>
<body>
	<div class="ContainerBox"
		style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">
		<div class="headTopBox">
			<div class="contentBody">
				<div class="topline">
					<div class="top">
						<div class="toplineleft">
							<span class="wzh-won">谷粒·惠精彩</span>
							<!-- <ul>
								<li><a href="javascript:void(0)"
									id="index_login_button" class="top-userlogin">请您登录</a></li>

								<li><a
									href="javascript:void(0)">注册有礼</a></li>
							</ul> -->
						</div>
						<div class="menu">
							<ul class="tlrtext">
								<li><span class="topwelcome"> <q>您好， 欢迎来到谷粒！</q>
								</span></li>
								<li><a
									href="javascript:void(0)">用户中心<i
										class="triangleIco"></i></a>
									<ul class="topMenu-text">
										<!--  <li><a href="/user/userBasicinfoPage.html"
									id="user_accountinfo">谷粒信息</a></li>-->
										<!-- <li><a
											href="javascript:void(0)"
											id="topbar_userinfo">个人资料</a></li>
										<li><a
											href="javascript:void(0)"
											id="user_accountinfo">基本信息</a></li>
										<li><a
											href="javascript:void(0)"
											id="topbar_bindwzk">我的谷粒卡</a></li>
										<li><a
											href="javascript:void(0)"
											id="topbar_collect">我的收藏</a></li>
										<li><a
											href="javascript:void(0)"
											id="topbar_jifen">我的积分</a></li>
										<li><a
											href="javascript:void(0)">我的评价</a></li> -->
										<li><a href="javascript:void(0)"
											id="topbar_order">我的订单</a></li>
									</ul></li>

								<li style="display: none;"><a
									href="javascript:void(0)"
									id="shopping_card_button"><i class="triangleIco"></i> 购物车 <q
										id="shoppingCart"></q> 件</a>
									<ul>
										<div class="top-cart" id="headerShoppingCart">
											<div class="cartNoGoods">
												<i class="TopCartIco"></i>再去逛逛吧，还什么都没有
											</div>
										</div>
										<!--top-cart-->
									</ul></li>

								<li><a
									href="javascript:void(0)">联系客服<i
										class="triangleIco"></i></a>
									<ul class="topMenu-text">
										<li><a id="topbar_tuikuan" target="_blank"
											href="javascript:void(0)">申请退款</a></li>
										<li><a id="topbar_bangdingshouji" target="_blank"
											href="javascript:void(0)">换绑手机号</a></li>
										<li><a id="topbar_tuanjuan" target="_blank"
											href="javascript:void(0)">查看谷粒券</a></li>
									</ul></li>
								<!-- 
						<li><a href="/apply/applyWZCardInitPage.html"  >谷粒卡申请</a>
						   <ul class="topMenu-text"></ul>
						</li>
						 -->
								<li><a
									href="javascript:void(0)">我是商家<i
										class="triangleIco"></i></a>
									<ul class="topMenu-text">
										<li><a id="topbar_question" target="_blank"
											href="javascript:void(0)">合作中心</a></li>
									</ul></li>
								<li><a href="javascript:void(0)" target="_blank">谷粒国际<i
										class="triangleIco"></i></a></li>
								<li><a
									href="javascript:void(0)">更多<i
										class="triangleIco"></i></a>
									<ul class="topMenu-text">
										<!-- <li><a id="topbar_email_order" href="javascript:alert('暂未开通,敬请期待')">邮件订阅</a></li> -->
										<li><a href="javascript:void(0)" id="topbar_collect_net"
											rel="sidebar" title="谷粒">收藏本站</a></li>
										<li><a id="topbar_question" target="_blank"
											href="javascript:void(0)">常见问题</a></li>
									</ul></li>
							</ul>
						</div>
					</div>
				</div>
				<!--topline-->
				<!--头部、LOGO、搜索栏-->
				<div class="headCont">
					<!--LOGO-->
					<div class="TopLogo">
						<a href="javascript:void(0)" class=""><img
							src="" title="谷粒"></a>
					</div>
					<!--搜索栏-->
					<form action="" method="get">
						<div class="search">
							<input type="text" x-webkit-speech="x-webkit-speech"
								autocomplete="off" placeholder="请输入商品名称、地址等" class="search-text"
								id="w" name="w" value="">
							<div class="search-button">
								<a href="" target="ifm">
									<button class="btn-search" type="submit" value="搜索">搜索</button>
								</a>
							</div>
						</div>
					</form>
					<!--保证-->
					<div class="ensure">
						<a href="" class="wzhImg refund"></a> <a href=""
							class="wzhImg guo"></a> <a href="" class="wzhImg ka"></a>
					</div>

					<!--主导航菜单-->
					<div class="whz-mainNav wzh-container" style="">
						<div class="whz-mainNav-hd">
							<span class="wzh-mainNav-tit">全部商品分类
								<div class="whz-mainNav-hd-cont">
									<ul>
										<li><a href="">美食</a>
											<div class="wzh-mainNav-three">
												<h4>美食</h4>
												<ul>
													<li><a href="">蛋糕</a></li>
													<li><a href="">甜点饮品</a></li>
													<li><a href="">其他美食</a></li>
													<li><a href="">家常菜</a></li>
													<li><a href="">小吃快餐</a></li>
													<li><a href="">韩国料理</a></li>
												</ul>
											</div></li>
										<li><a href="">娱乐</a>
											<div class="wzh-mainNav-three">
												<h4>娱乐</h4>
												<ul>
												</ul>
											</div></li>
										<li><a href="">酒店</a>
											<div class="wzh-mainNav-three">
												<h4>酒店</h4>
												<ul>
												</ul>
											</div></li>
										<li><a href="">生活</a>
											<div class="wzh-mainNav-three">
												<h4>生活</h4>
												<ul>
													<li><a href="">其他生活</a></li>
													<li><a href="">体检保健</a></li>
													<li><a href="">培训课程</a></li>
												</ul>
											</div></li>
										<li><a href="">丽人</a>
											<div class="wzh-mainNav-three">
												<h4>丽人</h4>
												<ul>
													<li><a href="">美容美体</a></li>
													<li><a href="">美甲</a></li>
												</ul>
											</div></li>
										<li><a href="">旅游</a>
											<div class="wzh-mainNav-three">
												<h4>旅游</h4>
												<ul>
												</ul>
											</div></li>
									</ul>
								</div>
							</span>
						</div>
						<ul class="whz-mainNav-menu">
							<li><a href="homepage.html">首页</a></li>
							<LI><A href="gflshow.html?smzq=miaoshazhuanqu">秒杀专区</A></LI>
							<LI><A href="gflshow.html?smzq=maizengzhuanqu">买赠专区</A></LI>
							<LI><A href="gflshow.html?smzq=pingpaizhuanqu">品牌专区</A></LI>
							<LI><A href="gflshow.html?smzq=luojiazhuanqu&parent=G14630381061319232">裸价专区</A></LI>
							<!-- <LI><A href="gflshow.html?smzq=luojiazhuanqu&parent=43">粮油米面</A></LI>
							<LI><A href="gflshow.html?smzq=luojiazhuanqu&parent=42">调味酱汁</A></LI>
							<LI><A href="gflshow.html?smzq=luojiazhuanqu&parent=41">南北干货</A></LI>
							<LI><A href="gflshow.html?smzq=luojiazhuanqu&parent=39">餐厨用品</A></LI> -->
						</ul>
					</div>
				</div>
			</div>
			<!-- headTopBox -->
		</div>
		<!--contentBody-->
		<!-- headTop -->

		<!-- navBox -->
		<div class="UpTop" style="top: 554px;">
			<ul>
				<!-- <li class="Up-help">
             	<i class="wzhImg r-help"></i>
                <a class="upTop-text" href="#">帮助中心</a>
             </li> -->
				<li class="Up-feedback"><i class="wzhImg r-opinion"></i> <a
					class="upTop-text" href="">意见反馈</a></li>
				<li class="goTopBtn" style="display: block; left: 1283px;"><i
					class="wzhImg UpTop-fx"></i> <a class="upTop-text" href="">返回顶部</a></li>
			</ul>
		</div>
		<!--UpTop-->
		<script type="text/javascript" src="js/base.js"></script>
		<script type="text/javascript">
			$(function() {
				//part1
				$(".wzh-mainNav-tit").hover(
						function() {
							$(this).children(".whz-mainNav-hd-cont", "this")
									.fadeToggle(0);
						})
				$(window).scroll(function() {
					var sc = $(window).scrollTop();
					var rwidth = $(window).width()
					if (sc > 0) {
						$("#goTopBtn").css("display", "block");
						$("#goTopBtn").css("left", (rwidth - 36) + "px");
					} else {
						$("#goTopBtn").css("display", "none");
					}
				});
				$("#goTopBtn").click(function() {
					var sc = $(window).scrollTop();
					$('body,html').animate({
						scrollTop : 0
					}, 100);
				});
			});
		</script>
		<script type="text/javascript">
			var pathname = window.location.pathname;//获取url路径
			jQuery(".whz-mainNav-menu").children("li").each(
					function() {
						jQuery(this).children("a").each(
								function() {
									var selectUrl = jQuery(this).attr("href");
									if (selectUrl.indexOf("?") > 0) {
										selectUrl = selectUrl.substring(0,
												selectUrl.indexOf("?"));
									}
									if (pathname == selectUrl) {
										jQuery(this).addClass("selectedHover");
									}
								});
					});

			$("#topbar_collect_net")
					.click(
							function() {
								if (!!window.ActiveXObject
										|| "ActiveXObject" in window) {
									window.external.addFavorite(document.URL,
											document.title);
								} else if (isFirefox = navigator.userAgent
										.indexOf("Firefox") > 0) {
									window.sidebar.addPanel(document.title,
											document.URL, "");
								} else {
									alert("您的浏览器暂不支持此操作，请使用Ctrl+D进行添加,或手动在浏览器里进行设置.");
								}
							});
		</script>
		<!--主体开始-->
		<div class="contentBody"
			style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">

			<div class="location">
				<a href="homepage.html">首页</a> » 
				<a href="javascript:void(0)" categoryid="1002">美食</a> » 
				<a href="javascript:void(0)" categoryid="10021057" id="footCate">蛋糕</a>
			</div>
			<!--sp-Title-->
			<div class="clearD"></div>
			<div class="leftSubject leftBox-f"
				style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">

				<div class="deal-box"
					style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">
					<div style="display: none" id="userIds"></div>
					<header class="deal-title">
						<span class="deal-sj-tit"></span>
						<!-- 这里是买赠信息 -->
						<h3 class="deal-sj-tit-mzInfo"></h3>
					</header>
					<div class="deal-introduce-img">
						<img class="scrollLoading" id="converPicture" width="550"
							height="327" onerror="" src="">
					</div>
					<!--deal-introduce-img-->
					<div class="deal-introduce-info"
						style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">

						<ul>
							<li
								style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">
								<div class="deal-sp-price"
									style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">
									<div class="original-price"
										style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">
										<!-- 	                            		现价： -->
										<strong id="yufu"
											style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">¥29.00</strong>
									<!-- 这里是原价 -->
										<del style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">￥998</del>
									</div>
									<!-- <div class="now-pay" style="font-family: &amp; amp; #39;Microsoft Yahei&amp;amp;#39;;">
										买一箱，送5kg恒大珍珠米一号4袋，送900ml恒大葵花籽油4瓶！
									</div> -->
								</div>
							</li>
							<li>
								<div class="buy_statistics">
									已售 <strong><q id="alreadySold"></q></strong> <span>剩余 <strong></strong></span>
								</div>
							</li>
							<li><label>物流</label> <span class="goods-date"></span></li>
							<li class="order-number"><label>数量</label>
								<button type="button" class="item-minus" value="-" max="300">-</button>
								<input type="text" class="order-num-s" name="orderNumber" readonly="readonly"
								value="1" max="300">
								<button type="button" class="item-plus" value="+" max="300">+</button>
								
								<span class="order-number-msg" style="display: none">仅可购买<strong>300</strong>件商品
							</span></li>
							<li><span class="buy-area"> <input type="button"
									class="button" id="to_NOWshopping" value="立即购买" alt="snapBut">
									<input type="button"
									class="button" id="to_shopping" value="加入购物车" alt="snapBut">
									<span hidden="true" id="span-gdata"></span>
									<a href="javascript:void(0);" title="收藏" id="add_collect_info"
									name="add_collect_info" class="big-link2"
									data-reveal-id="J-favorite-dialog" data-animation="fade"> <i
										class="collection"></i>收藏(0)
								</a>
							</span> 
							 <span class="media-fx">
									<div class="bdsharebuttonbox bdshare-button-style0-16"
										data-bd-bind="1467079239641">
										<a
											href="javascript:void(0)"
											class="bds_more" data-cmd="more"></a> <a
											href="javascript:void(0)"
											class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a> <a
											href="javascript:void(0)"
											class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a> <a
											href="javascript:void(0)"
											class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a> <a
											href="javascript:void(0)"
											class="bds_renren" data-cmd="renren" title="分享到人人网"></a> <a
											href="javascript:void(0)"
											class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
									</div>
							</span></li>
						</ul>
					</div>
				</div>
			</div>

			<div class="clearD"></div>
		</div>



		<div class="clearD"></div>
		<!--clearD-->
	</div>
	<!--页脚开始-->
	<div id="footBot">
		<div class="footBox">
			<div class="wzh-footer">
				<ul>
					<li><a href="javascript:void(0)">关于我们</a></li>
					<li><a href="javascript:void(0)">加入我们</a></li>
					<li><a href="javascript:void(0)">入门教程</a></li>
					<li><a href="javascript:void(0)">谷粒承诺</a></li>
					<li><a
						href="javascript:void(0)">反诈骗公告</a></li>
					<li><a
						href="javascript:void(0)">隐私声明</a></li>
				</ul>
				<p style="color: #fff;">©2016 版权所有 上海域链信息科技有限公司</p>
			</div>
		</div>
		<!--headTopBox-->
	</div>

<script type="text/javascript">
var goodsid = getQueryString("goodsid");
var customer = JSON.parse(window.localStorage.getItem("customer"));
var type = getQueryString("type");
$(function() {
	if(type == 'sp'){
		$.ajax({
			url:"GoodsviewAction.do?method=goodsxd",
			type:"post",
			data:{
				customerid:customer.customerid,
				goodsid:goodsid
			},
			success:function(resp){
				var goodsJSON = JSON.parse(resp).root[0];
				$("#span-gdata").text(JSON.stringify(goodsJSON));
				$(".deal-sj-tit").html(goodsJSON.goodsname + '<span class="prs_Unit">('+ goodsJSON.goodsunits + ')</span>');
				$("#yufu").text("￥" + goodsJSON.pricesprice + "/" + goodsJSON.pricesunit);
				$("#yufu").next().remove();
				var goods_date = goodsJSON.companydetail;
				if(goodsJSON.goodstype){
					goods_date += "."+goodsJSON.goodstype;
				}
				$(".goods-date").text(goods_date);
				$(".buy_statistics").html('<label>经销商</label> <span class="goods-date" style="color:black">'+goodsJSON.companyshop+'</span>');
				$(".scrollLoading").attr("src", goodsJSON.goodsimage);
				$(".order-num-s").val(getcurrennum(goodsJSON.goodsid,goodsJSON.goodsclassname));
				$(".item-plus").click(function() {
					var num = parseInt($(".order-num-s").val());
					$(".order-num-s").val(num + 1);
				});
				$(".item-minus").click(function() {
					var num = parseInt($(".order-num-s").val());
					if (num > 1) {
						$(".order-num-s").val(num - 1);
					}
				});
				$("#to_shopping").click(function (){
					doCart();
				});
				$("#to_NOWshopping").click(function(){
					if(doCart()){
						window.location.href = 'cart.html';
					}
				});
			},
			error : function(resp){
				var respText = eval('('+resp+')');
				alert(respText.msg);
			}
		});
	} else if(type=='ms'){
		$.ajax({
			url:"TimegoodsviewAction.do?method=msGoodsxd",
			type:"post",
			data:{
				customerid:customer.customerid,
				timegoodsid:goodsid
			},
			success:function(resp){
				var goodsJSON = eval('('+resp+')').root[0];
				var xlnum = parseInt(goodsJSON.timegoodsdetail);
				if(xlnum <= 0){
					$(".order-num-s").val(0);
				}
				$("#span-gdata").text(JSON.stringify(goodsJSON));
				$(".deal-sj-tit").html(goodsJSON.timegoodsname + '<span class="prs_Unit">('+ goodsJSON.timegoodsunits + ')</span>');
				$("#yufu").text("￥" + goodsJSON.timegoodsorgprice + "/" + goodsJSON.timegoodsunit);
				$("#yufu").next().text('￥'+ goodsJSON.timegoodsprice );
				$(".goods-date").text(goodsJSON.companydetail);
				$('#alreadySold').text(goodsJSON.allnum - goodsJSON.surplusnum);
				if(goodsJSON.allnum == -1){
					$('.buy_statistics span').remove();
				} else {
					$('.buy_statistics strong:eq(1)').text(goodsJSON.surplusnum);
				}
				$(".scrollLoading").attr("src", goodsJSON.timegoodsimage);
				$(".order-num-s").val(getcurrennum(goodsJSON.timegoodsid,goodsJSON.timegoodsclass));				//输入框的值
				$(".item-plus").attr("name",xlnum);
				$(".item-plus").click(function() {
					var num = parseInt($(".order-num-s").val());
					var nxlnum = parseInt($(".item-plus").attr("name"));
					if(nxlnum <= num){
						alert("您今天的购买数量已到达限购数量了哦。");
					} else if(goodsJSON.surplusnum <= num){
						alert("商品的剩余数量不足。");
					} else {
						$(".order-num-s").val(num + 1);
					}
				});
				$(".item-minus").click(function() {
					var num = parseInt($(".order-num-s").val());
					if (num > 1) {
						$(".order-num-s").val(num - 1);
					}
				});
				$("#to_shopping").click(function (){
					doCart();
				});
				$("#to_NOWshopping").click(function(){
					if(doCart()){
						window.location.href = 'cart.html';
					}
				});
			},
			error : function(resp){
				var respText = eval('('+resp+')');
				alert(respText.msg);
			}
		});
	} else if(type=='mz'){
		$.ajax({
			url:"GivegoodsviewAction.do?method=mzGoodsxd",
			type:"post",
			data:{
				customerid:customer.customerid,
				givegoodsid:goodsid
			},
			success:function(resp){
				var goodsJSON = eval('('+resp+')').root[0];
				var xlnum = parseInt(goodsJSON.creator);
				if(xlnum <= 0){
					$(".order-num-s").val(0);
				}
				$("#span-gdata").text(JSON.stringify(goodsJSON));
				$(".deal-sj-tit").html(goodsJSON.givegoodsname + '<span class="prs_Unit">('+ goodsJSON.givegoodsunits + ')</span>');
				$("#yufu").text("￥" + goodsJSON.givegoodsprice + "/" + goodsJSON.givegoodsunit);
				$("#yufu").next().remove();
				$(".goods-date").text(goodsJSON.companydetail);
				$(".buy_statistics").html('<label>经销商</label> <span class="goods-date" style="color:black">'+goodsJSON.companyshop+'</span>');
				$(".scrollLoading").attr("src", goodsJSON.givegoodsimage);
				$(".item-plus").attr("name",xlnum);
				$(".order-num-s").val(getcurrennum(goodsJSON.givegoodsid,goodsJSON.givegoodsclass));				//输入框的值
				$(".item-plus").click(function() {
					var num = parseInt($(".order-num-s").val());
					var nxlnum = parseInt($(".item-plus").attr("name"));
					if(nxlnum <= num ){
						alert("您今天的购买数量已到达限购数量了哦。");
					} else {
						$(".order-num-s").val(num + 1);
					}
				});
				$(".item-minus").click(function() {
					var num = parseInt($(".order-num-s").val());
					if (num > 1) {
						$(".order-num-s").val(num - 1);
					}
				});
				$("#to_shopping").click(function (){
					doCart();
				});
				$("#to_NOWshopping").click(function(){
					if(doCart()){
						window.location.href = 'cart.html';
					}
				});
			},
			error : function(resp){
				var respText = eval('('+resp+')');
				alert(respText.msg);
			}
		});
	}
});

//得到商品数量
function getcurrennum(dishesid,goodsclassname){
	//订单
	if(window.localStorage.getItem("sdishes")==null){
		return 0;
	}else{
		var orderdetnum = 0;
		var sdishes = JSON.parse(window.localStorage.getItem("sdishes"));
		$.each(sdishes, function(i, item) {
			if(item.goodsid==dishesid
					&&item.goodsclassname==goodsclassname){
				orderdetnum = item.orderdetnum;
				return false;
			}
		});
		return orderdetnum;
	}
}
//加入购物车
function doCart() {
	var goodsJSON = JSON.parse($("#span-gdata").text());
	var price = 0.0;
	var goodsid = '';
	var goodsclassname = '';
	if(type=='sp'){
		price = goodsJSON.pricesprice;
		goodsid = goodsJSON.goodsid;
		goodsclassname = goodsJSON.goodsclassname;
	} else if(type=='ms'){
		price = goodsJSON.timegoodsorgprice;
		goodsid = goodsJSON.timegoodsid;
		goodsclassname = goodsJSON.timegoodsclass;
	} else if(type=='mz'){
		price = goodsJSON.givegoodsprice;
		goodsid = goodsJSON.givegoodsid;
		goodsclassname = goodsJSON.givegoodsclass;
	}
	var num = parseInt($(".order-num-s").val());
	if(num == 0){
		alert('请选择购买的数量。');
		return;
	}
	var flag = false;
	if (window.localStorage.getItem("sdishes") == null || window.localStorage.getItem("sdishes") == "[]") { //判断有没有购物车
		window.localStorage.setItem("sdishes", "[]"); 														//创建一个购物车
		if(type=='sp'){
			flag = addMdishes(goodsJSON);						//加入购物车
		} else if(type=='ms'){
			flag = addMMSdishes(goodsJSON);
		} else if(type=='mz'){
			flag = addMMZdishes(goodsJSON);
		}
		if(flag == false){
			return;
		}
		window.localStorage.setItem("totalnum", 1); 														//设置缓存中的种类数量等于一 
		window.localStorage.setItem("totalmoney",(parseFloat(price) * num).toFixed(2)); 	//总金额等于商品价
		var cartnum = parseInt(window.localStorage.getItem("cartnum")); 									//商品总数
		window.localStorage.setItem("cartnum", $(".order-num-s").val());
	} else {
		var sdishes = JSON.parse(window.localStorage.getItem("sdishes")); 									//将缓存中的sdishes(字符串)转换为json对象
		var tnum = parseInt(window.localStorage.getItem("totalnum")); 										//取出商品的总类数
		$.each(sdishes,function(i, item) { 																	//遍历购物车中的商品
							if (item.goodsid == goodsid && item.goodsclassname == goodsclassname) {			//如果有这个商品
								window.localStorage.setItem("sdishes",JSON.stringify(sdishes));
								//var tmoney = parseFloat(window.localStorage.getItem("totalmoney")); 		//从缓存中取出总金额 
								var newtmoney = (parseFloat(price)* num).toFixed(2);
								window.localStorage.setItem("totalmoney", newtmoney);
								var cartnum = parseInt(window.localStorage.getItem("cartnum"));
								window.localStorage.setItem("cartnum",(cartnum - item.orderdetnum) + num);
								item.orderdetnum = num;														//把商品数量修改为新的数量
								flag = true;
								return false;
							} else if (i == (tnum - 1)) {
								if(type=='sp'){
									flag = addMdishes(goodsJSON);						//加入购物车
								} else if(type=='ms'){
									flag = addMMSdishes(goodsJSON);
								} else if(type=='mz'){
									flag = addMMZdishes(goodsJSON);
								}
								if(flag == false){
									return;
								}
								window.localStorage.setItem("totalnum",tnum + 1); 							//商品种类数加一
								var tmoney = parseFloat(window.localStorage.getItem("totalmoney")); 		//从缓存中取出总金额
								var newtmoney = (tmoney + parseFloat(price)* num).toFixed(2);
								window.localStorage.setItem("totalmoney", newtmoney);
								var cartnum = parseInt(window.localStorage.getItem("cartnum"));
								window.localStorage.setItem("cartnum",cartnum + num);
							}
						})
	}
	if(flag){
		alert("成功加入购物车!");
	} else {
		alert("加入购物车失败。");
	}
	return flag;
}
//新增买赠商品
function addMMZdishes(goodsJSON){
	var sdishes = JSON.parse(window.localStorage.getItem("sdishes")); 					//将缓存中的sdishes(字符串)转换为json对象
	var mdishes = new Object();
	mdishes.goodsid = goodsJSON.givegoodsid;
	mdishes.goodsdetail = goodsJSON.givegoodsdetail;
	mdishes.goodscompany = goodsJSON.givegoodscompany;
	mdishes.companyshop = goodsJSON.companyshop;
	mdishes.companydetail = goodsJSON.companydetail;
	mdishes.goodsclassname = goodsJSON.givegoodsclass;
	mdishes.goodscode = goodsJSON.givegoodscode;
	mdishes.pricesprice = goodsJSON.givegoodsprice;
	mdishes.pricesunit = goodsJSON.givegoodsunit;
	mdishes.goodsname = goodsJSON.givegoodsname;
	mdishes.goodsunits = goodsJSON.givegoodsunits;
	mdishes.orderdetnum = $(".order-num-s").val();
	mdishes.goodsimage = goodsJSON.givegoodsimage;
	mdishes.orderdtype = '买赠';
	mdishes.timegoodsnum = goodsJSON.givegoodsnum;
	mdishes.todayxg = goodsJSON.creator;												//今日剩余的限购数量
	sdishes.push(mdishes); 																//往json对象中添加一个新的元素(订单)
	window.localStorage.setItem("sdishes", JSON.stringify(sdishes));
	return true;
}
//新增秒杀商品
function addMMSdishes(goodsJSON){
	var sdishes = JSON.parse(window.localStorage.getItem("sdishes")); 					//将缓存中的sdishes(字符串)转换为json对象
	var mdishes = new Object();
	mdishes.goodsid = goodsJSON.timegoodsid;
	mdishes.goodsdetail = 'miaosha';
	mdishes.goodscompany = goodsJSON.timegoodscompany;
	mdishes.companyshop = goodsJSON.companyshop;
	mdishes.companydetail = goodsJSON.companydetail;
	mdishes.goodsclassname = goodsJSON.timegoodsclass;
	mdishes.goodscode = goodsJSON.timegoodscode;
	mdishes.pricesprice = goodsJSON.timegoodsorgprice;
	mdishes.pricesunit = goodsJSON.timegoodsunit;
	mdishes.goodsname = goodsJSON.timegoodsname;
	mdishes.goodsunits = goodsJSON.timegoodsunits;
	mdishes.orderdetnum = $(".order-num-s").val();
	mdishes.goodsimage = goodsJSON.timegoodsimage;
	mdishes.orderdtype = '秒杀';
	mdishes.surplusnum = goodsJSON.surplusnum;
	mdishes.timegoodsnum = goodsJSON.timegoodsnum;
	mdishes.todayxg = goodsJSON.timegoodsdetail;										//今日剩余的限购数量
	sdishes.push(mdishes); 																//往json对象中添加一个新的元素(订单)
	window.localStorage.setItem("sdishes", JSON.stringify(sdishes));
	return true;
}
//新增商品订单
function addMdishes(goodsJSON) {
	var sdishes = JSON.parse(window.localStorage.getItem("sdishes")); 					//将缓存中的sdishes(字符串)转换为json对象
	var mdishes = new Object();
	mdishes.goodsid = goodsJSON.goodsid;
	mdishes.goodsdetail = goodsJSON.goodsdetail;
	mdishes.goodscompany = goodsJSON.goodscompany;
	mdishes.companyshop = goodsJSON.companyshop;
	mdishes.companydetail = goodsJSON.companydetail;
	mdishes.goodsclassname = goodsJSON.goodsclassname;
	mdishes.goodscode = goodsJSON.goodscode;
	mdishes.pricesprice = goodsJSON.pricesprice;
	mdishes.pricesunit = goodsJSON.goodsunit;
	mdishes.goodsname = goodsJSON.goodsname;
	mdishes.goodsimage = goodsJSON.goodsimage;
	mdishes.orderdtype = '商品';
	mdishes.goodsunits = goodsJSON.goodsunits;
	mdishes.orderdetnum = $(".order-num-s").val();
	sdishes.push(mdishes); 																//往json对象中添加一个新的元素(订单)
	window.localStorage.setItem("sdishes", JSON.stringify(sdishes));
	return true;
}
</script>
</body>
</html>