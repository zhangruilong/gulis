<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Charisma, a fully featured, responsive, HTML5, Bootstrap admin template.">
<title>谷粒网</title>
<link rel="stylesheet" type="text/css" href="css/index.css"/>
<link rel="stylesheet" type="text/css" href="css/top1.css"/>
<link rel="stylesheet" type="text/css" href="css/news.css"/>
<link rel="stylesheet" type="text/css" href="css/bottom.css"/>
<link rel="stylesheet" type="text/css" href="css/plusslider.css"/>
<link rel="stylesheet" type="text/css" href="css/buy.css"/>
<link rel="stylesheet" type="text/css" href="css/pay.css"/>
<link rel="stylesheet" type="text/css" href="css/information.css"/>
<link rel="stylesheet" type="text/css" href="css/order.css"/>
<link rel="stylesheet" type="text/css" href="css/details.css"/>
<link rel="stylesheet" type="text/css" href="css/bindphone.css">
<script type="text/javascript">
var customer = JSON.parse(window.localStorage.getItem("customer"));
</script>
</head>

<body>
    <div class="all">
        <div class="toptop">
            
                                <div class="topline">
    <div class="top">
                    <!-- <div class="toplineleft">
                        <a href="#"><img src="images/wjxt.jpg" width="12" height="11">收藏我们</a>
                        <span>中国消费增值示范企业</span>
                    </div> -->
                    <div class="menu">
                        <ul class="tlrtext">
                        <li><span class="topwelcome" id="index_login_button" style="color:#666666">欢迎来到谷粒网！</span></li>
                          <!-- <li><a  href="login.html" id="index_login_button">登陆</a><span>|</span></li>
                          
                          <li><a href="register.html"  id="index_register_button">注册</a><span>|</span></li> -->
                          
                          <li >
                          <a class="hide"><span style="color:#666666;">用户中心</span>
                          </a><span>|</span>
                            <ul>
                                <li><a href="usershop.html">我的店铺</a></li>
								<li><a href="userorder.html">我的订单</a></li>
								<li><a href="usercollect.html">我的收藏</a></li>
								<li><a href="javascript:void(0)">我的谷币</a></li>
								<li><a href="useraddress.html">收货地址</a></li>
								<li><a href="bindingcom.html">我的供货商</a></li>
								<li><a href="userpwd.html">修改密码</a></li>
                            </ul>
                          </li>
                           
                            <!-- <li><a id="shopping_card_button" class="hide"><span ><img src="images/gouwuche.jpg" width="14" height="12" style="margin:13px 6px 0px 0px;width:12px;height:12px;"></span>
                             购物车 <font id="totalnum" style="color:#d71600;">0</font> 件</a><span>|</span></li> -->
                             
                             <!-- <li><a class="hide"><span style="color:#666666;">联系客服</span>
                             </a><span>|</span>
                                <ul >
                                    <li><a href="#" id="topbar_tuikuan">申请退款</a></li>
                                    <li><a href="#" id="topbar_tuihuo">申请退换货</a></li>
                                    <li><a href="#" id="topbar_tuanjuan">查看团劵</a></li>
                                    <li><a href="#" id="topbar_bangdingshouji">换绑手机</a></li>
                                </ul>
                            </li> -->
                            
                             <li><a class="hide" style="border:0px;" id="more_button"><span style="color:#666666;">更多</span>
                             </a><span>|</span>
                                <ul >
                                    <li><a href="#" id="topbar_collect_net">收藏本站</a></li>
                                    <li><a href="#" id="topbar_question">常见问题</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            
            
            <div class="logoline">
    <div class="top">
                    <div class="logoblock">
                        <div class="logoicon"><img src="images/logo.png" id="logo_index_img"></div>
                        
                    </div>
                    <div class="logosousuo">
                        <div class="nrssk">
                            <span><input class="nrsskinput1" type="text" name="textfield" id="w" placeholder="请输入要搜索的词" onkeydown="seachkeydow()"/></span>
                            <span><input class="nrsskinput2" type="button" name="textfield" id="index_search_button" onclick="doseach()" value="搜索"/></span>
                        </div>
                    </div>
                    <div class="zxfwblock"><img src="images/tuiguo.jpg" width="148" height="57"></div>
                </div>
           </div>
           
           <div class="navline">
    <div class="top">
                    <div class="navleft" id="index_navgation">
                     <span><a href="#" id="index_button">全部商品分类</a></span>
                        <span><a href="msgshow.html" >秒杀专区</a></span>
                       
                        <span><a href="mzgshow.html" >买赠专区</a></span>
                        <span><a onclick="dogoodsxdpage('G14630381061319233','');" href="gflshow.html" >品牌专区</a></span>
                        <span><a onclick="dogoodsxdpage('G14630381061319232','');" href="gflshow.html" >裸价专区</a></span>
                        
                        <span><a onclick="dogoodsxdpage('43','');" href="gflshow.html" >粮油米面</a></span>
                        <span><a onclick="dogoodsxdpage('42','');" href="gflshow.html" >调味酱汁</a></span>
                        <span><a onclick="dogoodsxdpage('41','');" href="gflshow.html" >南北干货</a></span>
                        <span><a onclick="dogoodsxdpage('39','');" href="gflshow.html" >餐厨用品</a></span>
                    </div>
                    
                </div>
           </div>
           
        </div>
        <div class="center">
            <div class="buyblock">
        <div class="cardblock">
            
            <div class="cardblline2">
                <div class="cardbl2left">购买步骤：</div>
                <div class="cardbl2right">
                    <img src="images/tjdd.png" width="713" height="35">
                   
                </div>
            </div>
            
            <div class="cardblxm">
                <div class="buyblxmline1">
                    <div class="buyblxml1text2b">&nbsp;</div>
                    <div class="buyblxml1text1b">商品名称</div>
                    <div class="buyblxml1text2b">状态</div>
                    <div class="buyblxml1text2b">数量</div>
                    <div class="buyblxml1text3b">单价</div>
                    <div class="buyblxml1text3b">单位</div>
                    <div class="buyblxml1text3b">小计</div>
                    <div class="buyblxml1text3b">操作</div>
                </div>
                <!-- <div class="buyblxmline2">
                    <div class="buyblxml1text4bb"><input type="checkbox" name="CheckboxGroup1" value="" id="checkbox1" /></div>
                    <div class="buyblxml1text1bb"><img src="images/xmimg.jpg" width="63" height="39"><span>猫眼电影【限手机选座】选座票一张。中影/金逸/和平6店通兑</span></div>
                    <div class="buyblxml1text2bb">可购买</div>
                    <div class="buyblxml1text2bb">
                    	<img src="images/jhicon.jpg" width="13" height="13" class="recue">
                    	<input type="text" name="textfield" class="amount_input" id="input_one"/>
                    	<img src="images/jhicon.png" width="13" height="13" style="margin-left:0px;margin-top:46px;width:13px;height:13px;" class="add">
                    </div>
                     <div class="buyblxml1text3bb">¥180</div>
                    <div class="buyblxml1text3bb">¥480</div>
                    <div class="buyblxml1text3bb">¥180</div>
                    <div class="buyblxml1text3bb"><img src="images/scicon.jpg" width="19" height="20" class="shoppingcard_delete"></div>
                </div> -->
                <!-- <div class="buyblxmline2">
                    <div class="buyblxml1text4bb"><input type="checkbox" name="CheckboxGroup1" value="" id="checkbox2" /></div>
                    <div class="buyblxml1text1bb"><img src="images/xmimg.jpg" width="63" height="39"><span>猫眼电影【限手机选座】选座票一张。中影/金逸/和平6店通兑</span></div>
                    <div class="buyblxml1text2bb">可购买</div>
                    <div class="buyblxml1text2bb">
                    	<img src="images/jhicon.jpg" width="13" height="13" class="recue">
                    	<input type="text" name="textfield" class="amount_input" id="input_two"/>
                    	<img src="images/jhicon.png" width="13" height="13" style="margin-left:0px;margin-top:46px;width:13px;height:13px;" class="add">
                    </div>
                    <div class="buyblxml1text3bb">¥180</div>
                    <div class="buyblxml1text3bb">¥480</div>
                    <div class="buyblxml1text3bb">¥180</div>
                    <div class="buyblxml1text3bb"><img src="images/scicon.jpg" width="19" height="20" class="shoppingcard_delete"></div>
                </div> -->
                <div class="buyblxmline3">
                <div class="buybltjddltext2">
                    <!-- <div class="buybltjddltline1">将发送谷粒网券密码至手机号：</div> -->
                    <!-- <div class="buybltjddltline2"><span>换号了？ </span> <span>绑定新手机号</span></div> -->
                </div>
                <div class="buyblxml3right"><span>共有</span><span class="buyblxml3text1"></span><span>种商品</span><span class="buyblxml3text2">&nbsp;&nbsp;</span><span class="buyblxml3text3"></span>
                <!-- <br><span>温馨提示：到店还需支付</span><span class="buyblxml3text1">¥300</span><span>现金</span> -->
                </div>
                </div>
            </div>
            
            <div class="buybltjddline">
                
                <div class="buybltjddlbt"><input type="button" name="button" onclick="nextpage()" value="" id="shopping_card_submit_order_button"/></div>
            </div>
        </div>
        
        
        
        
    </div>
        </div>
       <div class="bottom" id="shoppingcard_bottom_container"></div>
        


        <!-- <div id="bindnewphone-modal-content" >
            <div class="popup_bar" >
            <span>绑定新手机号</span>
                <a href="#"><img src="images/chah.jpg" width="11" height="11" border="0" id="bindnewphone_popup_window_close"></a>
            </div>
            <div class="shopline">
               <span>绑定手机号：</span><input type="text">
              
            </div>
            <div class="shopline">
               <span>验证码：</span><input type="text">
              
            </div>
            <div class="shopline">
               <span></span><input type="button" style="float:left;width:119px;height:40px;border:0px;background:url(images/bangd.jpg) no-repeat;">
              
            </div>
        </div> -->
    </div>

    
    <script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="js/base.js"></script>
    <script type="text/javascript" src="js/jquery.simplemodal.js"></script>
    <script type="text/javascript" src="js/jquery.plusslider.js"></script>
    <script type="text/javascript" src="js/jquery.easing.1.3.js"></script>
    <script type="text/javascript" src="js/cart-pay.js"></script>
    <script type="text/javascript" src="js/js.js"></script>
    <script type="text/javascript" src="js/shoppingcard.js"></script>
<script type="text/javascript">
$(function(){
	var scompany = setscompany();
	var sdishes = JSON.parse(window.localStorage.getItem("sdishes"));
	//购物车图标上的数量
	if(!window.localStorage.getItem("cartnum")){
		window.localStorage.setItem("cartnum",0);
	} else {
		$("#totalnum").text(window.localStorage.getItem("cartnum"));
	}
	$.each(scompany,function(i,item){
		$('.buybltjddltline1').text(item.companyshop);
		$(".buyblxml3right").append('<br><span class="buyblxml3text1">'+item.companydetail+'</span>');
	});
	showgszmoney();															//显示商品种类和总金额
	$.each(sdishes,function(i,item){
		$('.buyblxmline1').after('<div class="buyblxmline2">'+
                    '<div class="buyblxml1text4bb"><img src="'+item.goodsimage+'" width="60" height="60"></div>'+ 
                    '<div class="buyblxml1text1bb">'+item.goodsname+'</div>'+
                    '<div class="buyblxml1text2bb">可购买</div>'+
                    '<div class="buyblxml1text2bb" name="'+item.goodsid+'">'+
                    	'<img onclick="subnum(this,'+item.pricesprice+',\''+item.goodsclassname+'\')" src="images/jhicon.jpg" width="13" height="13" class="recue">'+
                    	'<input type="text" name="textfield" class="amount_input" readonly="readonly" id="input_two" value="'+item.orderdetnum+'"/>'+
                    	'<img onclick="addnum(this,'+item.pricesprice+',\''+item.goodscode+'\',\''+item.goodsclassname+'\')" name="'+item.todayxg+'" src="images/jhicon.png" width="13" height="13" style="margin-left:0px;margin-top:46px;width:13px;height:13px;" class="add">'+
                    '</div>'+
                    '<div class="buyblxml1text3bb">¥'+item.pricesprice+'</div>'+
                    '<div class="buyblxml1text3bb">'+item.pricesunit+'</div>'+
                    '<div class="buyblxml1text3bb">¥'+(item.pricesprice * item.orderdetnum)+'</div>'+
                    '<div class="buyblxml1text3bb"><img onclick="delorderGoods(this,\''+item.goodsid+'\',\''+item.goodsclassname+'\')" src="images/scicon.jpg" width="19" height="20" class="shoppingcard_delete"></div>'+
                '</div>');
	});
	
});
//商品分类
function dogoodsxdpage(parent,classname){
	window.localStorage.setItem("goodsclassparent",parent);
	window.localStorage.setItem("goodsclassname",classname);
}
//点击结算时执行的方法
function nextpage(){
	//整理购物车数据
	$("#shopping_card_submit_order_button").attr('onclick','');											//禁用按钮
	$.ajax({
		url:"OrderdAction.do?method=sortingSdiData",
		type:"post",
		data:{
			json:window.localStorage.getItem("sdishes"),
			customerid:customer.customerid
		},
		success:function(resp){
			var respText = eval('('+resp+')');
			if(respText.msg == '您购买的：'){
				var jsds = respText.root;										//sdishes的json
				if(respText.root.length==0){
					alert("购物车中没有商品.");
					window.location.href = "homepage.html";
					return;
				}
				window.localStorage.setItem("sdishes",JSON.stringify(jsds));
				var newcartnum = 0;
				var totalmoney = 0.00;
				var totalnum = 0;
				$.each(jsds,function(i,item){
					var money = parseFloat(parseFloat(item.pricesprice) * parseFloat(item.orderdetnum)).toFixed(2);
					newcartnum += parseInt(item.orderdetnum);
					totalmoney = parseFloat(money) + totalmoney;
					totalnum++;
				});
				window.localStorage.setItem("cartnum",newcartnum);
				window.localStorage.setItem("totalmoney",totalmoney.toFixed(2));
				window.localStorage.setItem("totalnum",totalnum);
				setscompany();		//设置供应商信息
				window.location.href = "pay.html";
			} else {
				alert(respText.msg);
				var jsds = respText.root;										//sdishes的json
				window.localStorage.setItem("sdishes",JSON.stringify(jsds));
				var newcartnum = 0;
				var totalmoney = 0.00;
				var totalnum = 0;
				$.each(jsds,function(i,item){
					var money = parseFloat(parseFloat(item.pricesprice) * parseFloat(item.orderdetnum)).toFixed(2);
					newcartnum += parseInt(item.orderdetnum);
					totalmoney = parseFloat(money) + totalmoney;
					totalnum++;
				});
				window.localStorage.setItem("cartnum",newcartnum);
				window.localStorage.setItem("totalmoney",totalmoney.toFixed(2));
				window.localStorage.setItem("totalnum",totalnum);
				setscompany();		//设置供应商信息
				if(respText.root.length == 0){
					alert("购物车中没有商品.");
					window.location.href = "homepage.html";
					return;
				}
				window.location.href = "pay.html";
			}
		},
		error : function(resp) {
			$("#shopping_card_submit_order_button").attr('onclick','nextpage()');								//启用按钮
			var respText = eval('('+resp+')');
			alert(respText.msg);
		}
	});
}
//删除购物车中的订单商品
function delorderGoods(obj,goodsid,goodsclassname){
	var sdishes = JSON.parse(window.localStorage.getItem("sdishes"));
	var ordernum = 0;
	var dishesmoney = 0;
	$.each(sdishes,function(i,item){
		if(item.goodsid==goodsid && item.goodsclassname==goodsclassname){
			ordernum = item.orderdetnum;
			dishesmoney = item.pricesprice * item.orderdetnum;
			sdishes.splice(i,1);											//删除订单
			return false;
		}
	});
	//种类数
	var tnum = parseInt(window.localStorage.getItem("totalnum"));
	window.localStorage.setItem("totalnum",tnum-1);
	//商品数
	var cartnum = parseInt(window.localStorage.getItem("cartnum"));
	window.localStorage.setItem("cartnum",cartnum-ordernum);
	//总金额
	var tmoney = parseFloat(window.localStorage.getItem("totalmoney"));
	var newtmoney = (tmoney-dishesmoney).toFixed(2);
	window.localStorage.setItem("totalmoney",newtmoney);
	window.localStorage.setItem("sdishes",JSON.stringify(sdishes));			//购物车
	$(obj).parent().parent().remove();
	if(JSON.stringify(sdishes) == "[]"){
		//如果是空购物车
		alert("购物车已清空。");
		window.location.href = "homepage.html";
	}
}
//显示商品种类和总金额
function showgszmoney(){
	$('.buyblxml3right span:eq(1)').text(window.localStorage.getItem("totalnum"));							//页面商品种类
	$('.buyblxml3right span:eq(4)').text('¥'+window.localStorage.getItem("totalmoney"));					//商品总金额
}
//加号
function addnum(obj,dishesprice,goodscode,goodsclassname){
	var sdishes = JSON.parse(window.localStorage.getItem("sdishes"));
	var cusMSOrderNum = parseInt($(obj).attr("name"));
	var numt = $(obj).prev(); 
	var num = parseInt(numt.val());
	var xjobj = $(obj).parent().nextAll('div:eq(2)');							//小计金额的对象
	if((parseInt(cusMSOrderNum) - num) <= 0){
		alert('您购买的商品超过了限购数量。');
	} else {
		//总价
		var tmoney = parseFloat(window.localStorage.getItem("totalmoney"));
		var newtmoney = (tmoney+dishesprice).toFixed(2);
		$("#totalmoney").text(newtmoney);
		window.localStorage.setItem("totalmoney",newtmoney);
		//数量
		numt.val(num+1);
		//订单
		if(window.localStorage.getItem("sdishes")==null){
			window.localStorage.setItem("sdishes","[]");
		}
		var sdishes = JSON.parse(window.localStorage.getItem("sdishes"));
		//修改订单
		$.each(sdishes, function(i, item) {
			if(item.goodsid==$(obj).parent().attr('name')
					&&item.goodsclassname==goodsclassname){
				item.orderdetnum++;
				xjobj.text("¥"+(item.orderdetnum * item.pricesprice));				//修改小计金额
				return false;
			}
		});
		window.localStorage.setItem("sdishes",JSON.stringify(sdishes));
		var cartnum = parseInt(window.localStorage.getItem("cartnum"));
		window.localStorage.setItem("cartnum",cartnum+1);
		showgszmoney();															//显示商品种类和总金额
	}
}
//减号
function subnum(obj,dishesprice,goodsclassname){
	var numt = $(obj).next(); 
	var num = parseInt(numt.val());
	var xjobj = $(obj).parent().nextAll('div:eq(2)');				//小计金额的对象
	if(num > 0){
		//总价
		var tmoney = parseFloat(window.localStorage.getItem("totalmoney"));
		var newtmoney = (tmoney-dishesprice).toFixed(2);
		$("#totalmoney").text(newtmoney);
		window.localStorage.setItem("totalmoney",newtmoney);
		//数量
		numt.val(num-1);
		//订单
		var sdishes = JSON.parse(window.localStorage.getItem("sdishes"));
		var scompany = JSON.parse(window.localStorage.getItem("scompany"));
		var delgoodsid = '-1';
		if(num == 1){
			//删除订单
			$.each(sdishes,function(i,item){
				if(item.goodsid==$(obj).parent().attr('name')){
					sdishes.splice(i,1);
					return false;
				};
			});
			//种类数
			var tnum = parseInt(window.localStorage.getItem("totalnum"));
			window.localStorage.setItem("totalnum",tnum-1);
			$(obj).parent().parent().remove();
		}else{
			//修改订单
			$.each(sdishes, function(i, item) {
				if(item.goodsid==$(obj).parent().attr('name')
						&&item.goodsclassname==goodsclassname){
					item.orderdetnum--;
					xjobj.text("¥"+(item.orderdetnum * item.pricesprice));				//修改小计金额
					return false;
				}
			});
		}
		window.localStorage.setItem("sdishes",JSON.stringify(sdishes));
		var cartnum = parseInt(window.localStorage.getItem("cartnum"));
		window.localStorage.setItem("cartnum",cartnum-1);
		showgszmoney();															//显示商品种类和总金额
		if(window.localStorage.getItem("sdishes") == "[]"){
			//如果是空购物车
			alert("购物车已清空。");
			window.location.href = "homepage.html";
		}
	}
}

</script>

</body>
</html>
    